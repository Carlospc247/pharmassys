{% extends "base.html" %}

{% block title %}Detalhe - {{ fornecedor.razao_social }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Detalhe do Fornecedor: {{ fornecedor.nome_exibicao }}</h2>
        
        {# Bloco de Ações Críticas (Ativar, Bloquear, Avaliar) #}
        <div class="btn-group">
            <a href="{% url 'fornecedores:avaliacao_create' fornecedor_pk=fornecedor.pk %}" class="btn btn-warning" title="Avaliar Performance">
                <i class="fas fa-star"></i> Avaliar
            </a>
            <a href="{% url 'fornecedores:historico_avaliacoes' pk=fornecedor.pk %}" class="btn btn-secondary" title="Ver Histórico">
                <i class="fas fa-history"></i> Histórico
            </a>

            {% if fornecedor.ativo %}
                <form method="post" action="{% url 'fornecedores:bloquear_fornecedor' pk=fornecedor.pk %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger" title="Bloquear Fornecedor">
                        <i class="fas fa-lock"></i> Bloquear
                    </button>
                </form>
            {% else %}
                <form method="post" action="{% url 'fornecedores:ativar_fornecedor' pk=fornecedor.pk %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success" title="Ativar Fornecedor">
                        <i class="fas fa-unlock"></i> Ativar
                    </button>
                </form>
            {% endif %}

            <a href="{% url 'fornecedores:editar_fornecedor' pk=fornecedor.pk %}" class="btn btn-info" title="Editar Dados">
                <i class="fas fa-edit"></i> Editar
            </a>
            <a href="{% url 'fornecedores:deletar_fornecedor' pk=fornecedor.pk %}" class="btn btn-danger" title="Eliminar Fornecedor">
                <i class="fas fa-trash-alt"></i> Eliminar
            </a>
        </div>
        
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            Informações Essenciais
        </div>
        <div class="card-body">
            <div class="row">
                
                {# Informações de Identificação e Foto #}
                <div class="col-md-4 text-center">
                    <img src="{{ fornecedor.foto.url }}" class="img-fluid rounded-circle mb-3" alt="Foto Fornecedor" style="width: 150px; height: 150px; object-fit: cover;">
                    <p class="h5">{{ fornecedor.razao_social }}</p>
                    <p class="text-muted">{{ fornecedor.get_categoria_display }} | {{ fornecedor.get_porte_display }}</p>
                    
                    <span class="badge 
                        {% if fornecedor.ativo and not fornecedor.bloqueado %}bg-success
                        {% elif fornecedor.bloqueado %}bg-danger
                        {% else %}bg-warning{% endif %} 
                        fs-6 mt-2">
                        {% if fornecedor.bloqueado %}BLOQUEADO: {{ fornecedor.motivo_bloqueio|default:"Motivo Não Registrado" }}
                        {% elif fornecedor.ativo %}STATUS: Ativo
                        {% else %}STATUS: Inativo{% endif %}
                    </span>
                </div>
                
                {# Dados de Contato e Documentos #}
                <div class="col-md-8">
                    <dl class="row">
                        <dt class="col-sm-4">Código / NIF:</dt>
                        <dd class="col-sm-8">{{ fornecedor.codigo_fornecedor }} / **{{ fornecedor.nif_bi }}**</dd>

                        <dt class="col-sm-4">Telefone Principal:</dt>
                        <dd class="col-sm-8">{{ fornecedor.telefone_principal|default:"N/A" }}</dd>

                        <dt class="col-sm-4">Email Principal:</dt>
                        <dd class="col-sm-8">{{ fornecedor.email_principal }}</dd>
                        
                        <dt class="col-sm-4">Endereço:</dt>
                        <dd class="col-sm-8 text-wrap">{{ fornecedor.endereco_completo }}</dd>
                        
                        <dt class="col-sm-4">Website:</dt>
                        <dd class="col-sm-8"><a href="{{ fornecedor.site }}" target="_blank">{{ fornecedor.site|default:"N/A" }}</a></dd>
                    </dl>
                </div>
            </div>
            
            <h5 class="mt-4 border-bottom pb-2">Desempenho e Condições Comerciais</h5>
            <dl class="row">
                <dt class="col-sm-4">Nota Média (0-10):</dt>
                <dd class="col-sm-8">
                    <span class="fw-bold text-success">{{ fornecedor.nota_avaliacao|floatformat:1|default:"N/A" }}</span>
                    (Total de Pedidos: {{ fornecedor.total_pedidos }})
                </dd>

                <dt class="col-sm-4">Total Comprado (Kz):</dt>
                <dd class="col-sm-8">**Kz {{ fornecedor.total_comprado|floatformat:2 }}**</dd>
                
                <dt class="col-sm-4">Prazo Padrão de Entrega:</dt>
                <dd class="col-sm-8">{{ fornecedor.prazo_entrega_dias }} dias</dd>
                
                <dt class="col-sm-4">Permite Devolução:</dt>
                <dd class="col-sm-8">{{ fornecedor.permite_devolucao|yesno:"Sim, Não" }} (Prazo: {{ fornecedor.prazo_devolucao_dias }} dias)</dd>
            </dl>
            
            <h5 class="mt-4 border-bottom pb-2">Observações</h5>
            <p>{{ fornecedor.observacoes|linebreaksbr|default:"Nenhuma observação geral registrada." }}</p>
        </div>
    </div>
    <div class="mt-3">
        <a href="{% url 'fornecedores:lista_fornecedores' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Voltar à Lista
        </a>
    </div>
</div>
{% endblock %}