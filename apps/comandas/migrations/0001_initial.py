# Generated by Django 5.1.5 on 2025-11-11 00:36

import django.core.validators
import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('clientes', '0002_initial'),
        ('core', '0001_initial'),
        ('funcionarios', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='CategoriaComanda',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('nome', models.CharField(max_length=100)),
                ('descricao', models.TextField(blank=True)),
                ('cor_exibicao', models.CharField(default='#007bff', help_text='Cor em hexadecimal para exibição', max_length=7)),
                ('icone', models.CharField(blank=True, help_text='Classe do ícone (FontAwesome, ex: fas fa-coffee)', max_length=50)),
                ('ordem_exibicao', models.IntegerField(default=0)),
                ('ativa', models.BooleanField(default=True)),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.empresa')),
            ],
            options={
                'verbose_name': 'Categoria de Comanda',
                'verbose_name_plural': 'Categorias de Comandas',
                'ordering': ['ordem_exibicao', 'nome'],
                'unique_together': {('nome', 'empresa')},
            },
        ),
        migrations.CreateModel(
            name='CentroRequisicao',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('codigo', models.CharField(max_length=10, unique=True)),
                ('nome', models.CharField(max_length=100)),
                ('tipo_centro', models.CharField(choices=[('cozinha', 'Cozinha'), ('bar', 'Bar'), ('lanchonete', 'Lanchonete'), ('confeitaria', 'Confeitaria'), ('chapeiro', 'Chapeiro'), ('saladas', 'Saladas'), ('bebidas', 'Bebidas'), ('sobremesas', 'Sobremesas'), ('outros', 'Outros')], max_length=15)),
                ('descricao', models.TextField(blank=True)),
                ('localizacao', models.CharField(blank=True, max_length=200)),
                ('andar', models.CharField(blank=True, max_length=20)),
                ('ativo', models.BooleanField(default=True)),
                ('aceita_pedidos', models.BooleanField(default=True)),
                ('imprime_automatico', models.BooleanField(default=True)),
                ('impressora_ip', models.CharField(blank=True, max_length=15)),
                ('impressora_nome', models.CharField(blank=True, max_length=100)),
                ('horario_inicio', models.TimeField(blank=True, null=True)),
                ('horario_fim', models.TimeField(blank=True, null=True)),
                ('ordem_preparo', models.IntegerField(default=0)),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.empresa')),
                ('responsavel', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='centros_responsavel', to='funcionarios.funcionario')),
            ],
            options={
                'verbose_name': 'Centro de Requisição',
                'verbose_name_plural': 'Centros de Requisição',
                'ordering': ['ordem_preparo', 'nome'],
                'unique_together': {('codigo', 'empresa')},
            },
        ),
        migrations.CreateModel(
            name='Comanda',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('numero_comanda', models.CharField(max_length=20, unique=True)),
                ('tipo_atendimento', models.CharField(choices=[('balcao', 'Balcão'), ('mesa', 'Mesa'), ('delivery', 'Delivery'), ('retirada', 'Retirada')], max_length=15)),
                ('data_abertura', models.DateTimeField(auto_now_add=True)),
                ('data_fechamento', models.DateTimeField(blank=True, null=True)),
                ('tempo_estimado_preparo', models.IntegerField(default=0, help_text='Tempo estimado total em minutos')),
                ('subtotal', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('desconto_valor', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('desconto_percentual', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('taxa_servico', models.DecimalField(decimal_places=2, default=0, max_digits=6)),
                ('total', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('valor_pago', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('status', models.CharField(choices=[('aberta', 'Aberta'), ('em_preparo', 'Em Preparo'), ('pronta', 'Pronta'), ('entregue', 'Entregue'), ('fechada', 'Fechada'), ('cancelada', 'Cancelada')], default='aberta', max_length=15)),
                ('observacoes', models.TextField(blank=True)),
                ('observacoes_cozinha', models.TextField(blank=True)),
                ('endereco_entrega', models.TextField(blank=True)),
                ('telefone_contato', models.CharField(blank=True, max_length=20)),
                ('taxa_entrega', models.DecimalField(decimal_places=2, default=0, max_digits=6)),
                ('atendente', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='comandas_atendidas', to='funcionarios.funcionario')),
                ('cliente', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='clientes.cliente')),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.empresa')),
            ],
            options={
                'verbose_name': 'Comanda',
                'verbose_name_plural': 'Comandas',
                'ordering': ['-data_abertura'],
            },
        ),
        migrations.CreateModel(
            name='ConfiguracaoComanda',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('taxa_servico_percentual', models.DecimalField(decimal_places=2, default=10, help_text='Taxa de serviço padrão (%)', max_digits=5)),
                ('taxa_entrega_valor', models.DecimalField(decimal_places=2, default=5, help_text='Taxa de entrega padrão (R$)', max_digits=6)),
                ('tempo_limite_preparo', models.IntegerField(default=30, help_text='Tempo limite para preparo (minutos)')),
                ('tempo_alerta_atraso', models.IntegerField(default=20, help_text='Alertar atraso após X minutos')),
                ('imprimir_automatico', models.BooleanField(default=True)),
                ('impressora_cozinha', models.CharField(blank=True, max_length=100)),
                ('impressora_balcao', models.CharField(blank=True, max_length=100)),
                ('permite_desconto', models.BooleanField(default=True)),
                ('desconto_maximo', models.DecimalField(decimal_places=2, default=20, help_text='Desconto máximo permitido (%)', max_digits=5)),
                ('permite_cancelamento', models.BooleanField(default=True)),
                ('permite_self_service', models.BooleanField(default=False)),
                ('empresa', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='config_comandas', to='core.empresa')),
            ],
            options={
                'verbose_name': 'Configuração de Comandas',
                'verbose_name_plural': 'Configurações de Comandas',
            },
        ),
        migrations.CreateModel(
            name='HistoricoComanda',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('acao', models.CharField(max_length=100)),
                ('descricao', models.TextField()),
                ('data_acao', models.DateTimeField(auto_now_add=True)),
                ('comanda', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='historico', to='comandas.comanda')),
                ('usuario', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Histórico da Comanda',
                'verbose_name_plural': 'Históricos das Comandas',
                'ordering': ['-data_acao'],
            },
        ),
        migrations.CreateModel(
            name='ItemComanda',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('quantidade', models.IntegerField(validators=[django.core.validators.MinValueValidator(1)])),
                ('preco_unitario', models.DecimalField(decimal_places=2, max_digits=8)),
                ('total', models.DecimalField(decimal_places=2, max_digits=10)),
                ('status', models.CharField(choices=[('pendente', 'Pendente'), ('em_preparo', 'Em Preparo'), ('pronto', 'Pronto'), ('entregue', 'Entregue'), ('cancelado', 'Cancelado')], default='pendente', max_length=15)),
                ('observacoes', models.TextField(blank=True)),
                ('hora_pedido', models.DateTimeField(auto_now_add=True)),
                ('hora_inicio_preparo', models.DateTimeField(blank=True, null=True)),
                ('hora_finalizacao', models.DateTimeField(blank=True, null=True)),
                ('hora_entrega', models.DateTimeField(blank=True, null=True)),
                ('comanda', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='itens', to='comandas.comanda')),
            ],
            options={
                'verbose_name': 'Item da Comanda',
                'verbose_name_plural': 'Itens da Comanda',
                'ordering': ['hora_pedido'],
            },
        ),
        migrations.CreateModel(
            name='Mesa',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('numero', models.CharField(max_length=10)),
                ('nome', models.CharField(blank=True, max_length=100)),
                ('capacidade', models.IntegerField(default=4)),
                ('localizacao', models.CharField(blank=True, max_length=100)),
                ('status', models.CharField(choices=[('livre', 'Livre'), ('ocupada', 'Ocupada'), ('reservada', 'Reservada'), ('limpeza', 'Em Limpeza'), ('manutencao', 'Manutenção')], default='livre', max_length=15)),
                ('observacoes', models.TextField(blank=True)),
                ('qr_code', models.UUIDField(default=uuid.uuid4, unique=True)),
                ('permite_self_service', models.BooleanField(default=False)),
                ('ativa', models.BooleanField(default=True)),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.empresa')),
                ('loja', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.loja')),
            ],
            options={
                'verbose_name': 'Mesa',
                'verbose_name_plural': 'Mesas',
                'ordering': ['numero'],
                'unique_together': {('numero', 'loja')},
            },
        ),
        migrations.AddField(
            model_name='comanda',
            name='mesa',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='comandas.mesa'),
        ),
        migrations.CreateModel(
            name='Pagamento',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('forma_pagamento', models.CharField(choices=[('dinheiro', 'Dinheiro'), ('cartao_debito', 'Cartão de Débito'), ('cartao_credito', 'Cartão de Crédito'), ('transferencia', 'Transferência'), ('vale_refeicao', 'Vale Refeição'), ('vale_alimentacao', 'Vale Alimentação'), ('credito_loja', 'Crédito da Loja')], max_length=20)),
                ('valor', models.DecimalField(decimal_places=2, max_digits=10)),
                ('numero_transacao', models.CharField(blank=True, max_length=100)),
                ('numero_autorizacao', models.CharField(blank=True, max_length=100)),
                ('bandeira_cartao', models.CharField(blank=True, max_length=50)),
                ('data_pagamento', models.DateTimeField(auto_now_add=True)),
                ('confirmado', models.BooleanField(default=True)),
                ('observacoes', models.TextField(blank=True)),
                ('comanda', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='pagamentos', to='comandas.comanda')),
            ],
            options={
                'verbose_name': 'Pagamento',
                'verbose_name_plural': 'Pagamentos',
                'ordering': ['-data_pagamento'],
            },
        ),
        migrations.CreateModel(
            name='MovimentacaoComanda',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('tipo_movimentacao', models.CharField(choices=[('abertura', 'Abertura'), ('adicao_item', 'Adição de Item'), ('remocao_item', 'Remoção de Item'), ('alteracao_item', 'Alteração de Item'), ('aplicacao_desconto', 'Aplicação de Desconto'), ('remocao_desconto', 'Remoção de Desconto'), ('adicao_taxa', 'Adição de Taxa'), ('pagamento', 'Pagamento'), ('cancelamento', 'Cancelamento'), ('fechamento', 'Fechamento'), ('transferencia_mesa', 'Transferência de Mesa'), ('divisao_conta', 'Divisão de Conta'), ('outros', 'Outros')], max_length=20)),
                ('descricao', models.TextField()),
                ('valor_anterior', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('valor_atual', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('valor_alteracao', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('dados_extras', models.JSONField(blank=True, default=dict)),
                ('data_movimentacao', models.DateTimeField(auto_now_add=True)),
                ('ip_origem', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True)),
                ('comanda', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='movimentacoes', to='comandas.comanda')),
                ('item_relacionado', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='comandas.itemcomanda')),
                ('usuario', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('pagamento_relacionado', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='comandas.pagamento')),
            ],
            options={
                'verbose_name': 'Movimentação da Comanda',
                'verbose_name_plural': 'Movimentações das Comandas',
                'ordering': ['-data_movimentacao'],
            },
        ),
        migrations.CreateModel(
            name='ProdutoComanda',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('codigo', models.CharField(max_length=20, unique=True)),
                ('nome', models.CharField(max_length=200)),
                ('descricao', models.TextField(blank=True)),
                ('preco_venda', models.DecimalField(decimal_places=2, max_digits=8)),
                ('preco_promocional', models.DecimalField(blank=True, decimal_places=2, max_digits=8, null=True)),
                ('disponivel', models.BooleanField(default=True)),
                ('destaque', models.BooleanField(default=False)),
                ('tempo_preparo_minutos', models.IntegerField(default=10, help_text='Tempo estimado de preparo em minutos')),
                ('controla_estoque', models.BooleanField(default=False)),
                ('quantidade_estoque', models.IntegerField(default=0)),
                ('estoque_minimo', models.IntegerField(default=0)),
                ('calorias', models.IntegerField(blank=True, null=True)),
                ('ingredientes', models.TextField(blank=True)),
                ('observacoes', models.TextField(blank=True)),
                ('imagem', models.ImageField(blank=True, null=True, upload_to='comandas/produtos/')),
                ('categoria', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='comandas.categoriacomanda')),
                ('centro_requisicao', models.ForeignKey(blank=True, help_text='Centro responsável pelo preparo deste item', null=True, on_delete=django.db.models.deletion.PROTECT, to='comandas.centrorequisicao')),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.empresa')),
            ],
            options={
                'verbose_name': 'Produto de Comanda',
                'verbose_name_plural': 'Produtos de Comandas',
                'ordering': ['categoria', 'nome'],
            },
        ),
        migrations.AddField(
            model_name='itemcomanda',
            name='produto',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='comandas.produtocomanda'),
        ),
        migrations.CreateModel(
            name='TemplateComanda',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('nome', models.CharField(max_length=200)),
                ('descricao', models.TextField(blank=True)),
                ('tipo_atendimento_padrao', models.CharField(choices=[('balcao', 'Balcão'), ('mesa', 'Mesa'), ('delivery', 'Delivery'), ('retirada', 'Retirada')], default='balcao', max_length=15)),
                ('aplica_taxa_servico', models.BooleanField(default=True)),
                ('taxa_servico_personalizada', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('observacoes_padrao', models.TextField(blank=True)),
                ('observacoes_cozinha_padrao', models.TextField(blank=True)),
                ('ativo', models.BooleanField(default=True)),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.empresa')),
            ],
            options={
                'verbose_name': 'Template de Comanda',
                'verbose_name_plural': 'Templates de Comandas',
                'ordering': ['nome'],
            },
        ),
        migrations.CreateModel(
            name='ItemTemplateComanda',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('quantidade_padrao', models.IntegerField(default=1)),
                ('observacoes_padrao', models.TextField(blank=True)),
                ('ordem', models.IntegerField(default=0)),
                ('produto', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='comandas.produtocomanda')),
                ('template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='itens_template', to='comandas.templatecomanda')),
            ],
            options={
                'verbose_name': 'Item do Template',
                'verbose_name_plural': 'Itens do Template',
                'ordering': ['ordem', 'produto__nome'],
            },
        ),
        migrations.AddIndex(
            model_name='comanda',
            index=models.Index(fields=['numero_comanda'], name='comandas_co_numero__c5502c_idx'),
        ),
        migrations.AddIndex(
            model_name='comanda',
            index=models.Index(fields=['status', 'data_abertura'], name='comandas_co_status_eb44c5_idx'),
        ),
        migrations.AddIndex(
            model_name='comanda',
            index=models.Index(fields=['atendente', 'data_abertura'], name='comandas_co_atenden_66e14d_idx'),
        ),
        migrations.AddIndex(
            model_name='movimentacaocomanda',
            index=models.Index(fields=['comanda', 'data_movimentacao'], name='comandas_mo_comanda_34d380_idx'),
        ),
        migrations.AddIndex(
            model_name='movimentacaocomanda',
            index=models.Index(fields=['tipo_movimentacao', 'data_movimentacao'], name='comandas_mo_tipo_mo_c15bf0_idx'),
        ),
        migrations.AddIndex(
            model_name='produtocomanda',
            index=models.Index(fields=['codigo'], name='comandas_pr_codigo_84ae41_idx'),
        ),
        migrations.AddIndex(
            model_name='produtocomanda',
            index=models.Index(fields=['categoria', 'disponivel'], name='comandas_pr_categor_de5500_idx'),
        ),
    ]
